echo "import { useState } from 'react'; import axios from 'axios'; const API_URL = 'https://script.google.com/macros/s/AKfycbyMR8--C3duIFLvIv8ikyv_qQArXQY4f0kjYwYVZmPDr4wumZlaMK_x4yjZO1MfoCAC/exec'; export default function Solicitacao() { const [form, setForm] = useState({ nomePeca: '', codigo: '', implemento: '', quantidade: '', urgencia: 'Normal', observacoes: '' }); const [foto, setFoto] = useState(null); const [loading, setLoading] = useState(false); const [resposta, setResposta] = useState(null); const handleChange = (e) => setForm({ ...form, [e.target.name]: e.target.value }); const enviarFormulario = async (e) => { e.preventDefault(); setLoading(true); try { let linkFoto = ''; if (foto) { const base64 = await toBase64(foto); const upload = await axios.post(API_URL, { tipo: 'upload', nomeArquivo: foto.name, base64: base64.split(',')[1] }); linkFoto = upload.data.link; } const res = await axios.post(API_URL, { tipo: 'solicitacao', ...form, linkFoto }); setResposta(res.data); } catch (err) { alert('Erro ao enviar: ' + err.message); } finally { setLoading(false); } }; const toBase64 = (file) => new Promise((resolve, reject) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = () => resolve(reader.result); reader.onerror = reject; }); return (<div className='p-6 bg-agro-light min-h-screen'><h1 className='text-2xl font-bold mb-4 text-center'>Solicitação de Compra</h1>{!resposta ? (<form onSubmit={enviarFormulario} className='max-w-lg mx-auto bg-white text-black p-6 rounded-lg shadow-lg'><input name='nomePeca' placeholder='Nome da Peça' onChange={handleChange} required /><input name='codigo' placeholder='Código de Referência' onChange={handleChange} /><input name='implemento' placeholder='Implemento' onChange={handleChange} required /><input name='quantidade' placeholder='Quantidade' type='number' onChange={handleChange} required /><select name='urgencia' onChange={handleChange}><option>Normal</option><option>Alta</option><option>Urgente</option></select><textarea name='observacoes' placeholder='Observações' onChange={handleChange}></textarea><label className='block mb-2'>Foto da Peça:</label><input type='file' accept='image/*' onChange={(e) => setFoto(e.target.files[0])} /><button type='submit' disabled={loading} className='w-full mt-4'>{loading ? 'Enviando...' : 'Enviar Solicitação'}</button></form>) : (<div className='text-center mt-8'><h2 className='text-2xl font-bold mb-4 text-white'>✅ Solicitação Enviada</h2><p>Número: {resposta.numero}</p><a href={resposta.pdfUrl} target='_blank' rel='noopener noreferrer' className='underline block my-2'>Ver PDF</a><button onClick={() => { const msg = encodeURIComponent(`Solicitação de compra nº ${resposta.numero}\\nPeça: ${form.nomePeca}\\nImplemento: ${form.implemento}\\nPDF: ${resposta.pdfUrl}`); window.open(`https://wa.me/?text=${msg}`); }} className='mt-4'>Enviar pelo WhatsApp</button></div>)}</div>); }" > pages/solicitacao.jsx
